---
name: Preview Canvas Component
status: open
created: 2026-01-14T19:29:10Z
updated: 2026-01-14T19:38:21Z
github: https://github.com/misterfulanito/badge-it/issues/7
depends_on: [2, 4, 5, 6]
parallel: false
conflicts_with: [8]
---

# Task: Preview Canvas Component

## Description
Create the PreviewCanvas component that renders a real-time composition of the cropped image with the selected badge overlay. Display at 512x512px on desktop, responsive on mobile. This is the core visual component users interact with.

## Acceptance Criteria
- [ ] Canvas displays cropped image as background
- [ ] Selected badge overlays at chosen position
- [ ] Updates in real-time when badge or position changes
- [ ] Canvas is 512x512px on desktop
- [ ] Canvas is responsive (100% width) on mobile, maintains 1:1 ratio
- [ ] Smooth rendering without flicker
- [ ] Shows placeholder state before image upload
- [ ] Canvas API errors handled gracefully

## Technical Details
- **Component**: `components/PreviewCanvas.vue`
- **Composable**: `composables/useImageProcessor.ts`

### Component Props
```typescript
interface Props {
  croppedImage: HTMLCanvasElement | null
  badge: Badge | null
  position: 'left' | 'center' | 'right'
}
```

### Canvas Rendering Logic
```typescript
// composables/useImageProcessor.ts
export const useImageProcessor = () => {
  const renderPreview = (
    canvas: HTMLCanvasElement,
    croppedImage: HTMLCanvasElement,
    badge: HTMLImageElement | null,
    position: BadgePosition
  ) => {
    const ctx = canvas.getContext('2d')
    const size = 512 // Preview size

    canvas.width = size
    canvas.height = size

    // Draw cropped image scaled to fill
    ctx.drawImage(croppedImage, 0, 0, size, size)

    // Draw badge if selected
    if (badge) {
      const badgeSize = size * 0.3 // Badge is 30% of canvas
      const coords = getPositionCoordinates(position, size, badgeSize)
      ctx.drawImage(badge, coords.x, coords.y, badgeSize, badgeSize)
    }
  }

  return { renderPreview }
}
```

### Responsive Styling
```css
.preview-canvas {
  width: 512px;
  height: 512px;
  border: 1px solid var(--surface-border);
  border-radius: 8px;
}

@media (max-width: 768px) {
  .preview-canvas {
    width: 100%;
    height: auto;
    aspect-ratio: 1;
  }
}
```

### Real-time Updates
```typescript
// Watch for changes and re-render
watch([croppedImage, badge, position], () => {
  if (croppedImage.value) {
    renderPreview(canvasRef.value, croppedImage.value, badge.value, position.value)
  }
}, { immediate: true })
```

## Dependencies
- [ ] Task 003: Image Cropper (provides cropped image)
- [ ] Task 004: Badge Library (provides selected badge)
- [ ] Task 005: Badge Positioner (provides position)

## Effort Estimate
- Size: M
- Hours: 3-4
- Parallel: false (integrates multiple components)

## Definition of Done
- [ ] Canvas renders cropped image
- [ ] Badge overlays correctly at all 3 positions
- [ ] Real-time updates work smoothly
- [ ] Responsive on mobile
- [ ] Placeholder state when no image
- [ ] No canvas API errors
