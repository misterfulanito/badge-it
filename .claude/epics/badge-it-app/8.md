---
name: Download Feature
status: open
created: 2026-01-14T19:29:10Z
updated: 2026-01-14T19:38:21Z
github: https://github.com/misterfulanito/badge-it/issues/8
depends_on: [2, 7]
parallel: false
conflicts_with: [7]
---

# Task: Download Feature

## Description
Implement the download functionality that exports the final composition as a 1024x1024px PNG file. The download composites the cropped image with the badge overlay and triggers a browser download.

## Acceptance Criteria
- [ ] Download button triggers PNG export
- [ ] Output resolution is exactly 1024x1024px
- [ ] Final image includes cropped background + badge overlay
- [ ] File downloads with meaningful name (e.g., "badge-it-profile.png")
- [ ] Success toast shown on download
- [ ] Error toast if download fails
- [ ] Button disabled if no image uploaded
- [ ] Works on all supported browsers (Chrome, Firefox, Safari, Edge)

## Technical Details
- **Component**: `components/ActionButtons.vue` (Download button)
- **Composable**: `composables/useImageProcessor.ts` (export logic)

### Export Function
```typescript
// composables/useImageProcessor.ts
export const useImageProcessor = () => {
  const exportImage = (
    croppedImage: HTMLCanvasElement,
    badge: HTMLImageElement | null,
    position: BadgePosition
  ): Promise<Blob> => {
    return new Promise((resolve, reject) => {
      const canvas = document.createElement('canvas')
      const ctx = canvas.getContext('2d')
      const size = 1024 // Export size

      canvas.width = size
      canvas.height = size

      // Draw cropped image scaled to 1024x1024
      ctx.drawImage(croppedImage, 0, 0, size, size)

      // Draw badge if selected
      if (badge) {
        const badgeSize = size * 0.3
        const coords = getPositionCoordinates(position, size, badgeSize)
        ctx.drawImage(badge, coords.x, coords.y, badgeSize, badgeSize)
      }

      canvas.toBlob((blob) => {
        if (blob) resolve(blob)
        else reject(new Error('Failed to create image'))
      }, 'image/png')
    })
  }

  return { exportImage }
}
```

### Download Trigger
```typescript
const downloadImage = async () => {
  try {
    const blob = await exportImage(croppedImage, badge, position)

    const url = URL.createObjectURL(blob)
    const link = document.createElement('a')
    link.href = url
    link.download = 'badge-it-profile.png'
    link.click()

    URL.revokeObjectURL(url)

    toast.add({ severity: 'success', summary: 'Downloaded!', detail: 'Your image has been saved.', life: 3000 })
  } catch (error) {
    toast.add({ severity: 'error', summary: 'Download failed', detail: 'Please try again.', life: 5000 })
  }
}
```

### Error Scenarios
| Scenario | Handling |
|----------|----------|
| Canvas toBlob fails | Show error toast, log to console |
| Browser blocks download | Show info toast with instructions |
| No image uploaded | Button disabled |

## Dependencies
- [ ] Task 006: Preview Canvas (uses same rendering logic)
- [ ] Task 008: Toast Notifications (for success/error messages)

## Effort Estimate
- Size: S
- Hours: 2-3
- Parallel: false (depends on preview canvas)

## Definition of Done
- [ ] Download button works
- [ ] Output is 1024x1024 PNG
- [ ] Image quality is high
- [ ] Toast notifications work
- [ ] Cross-browser tested
- [ ] Disabled state when no image
